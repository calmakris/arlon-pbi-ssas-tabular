{
  "name": "Absorption per Output Last 3 Months",
  "description": "Total absorption posted in the last 3 calendar months divided by the total output of departments. Casting and coating output is from machine data, Converting output is GR transaction, and others are delivered quantity of shop orders that ended in the last 3 months.",
  "expression": [
    "",
    "VAR BegDate = EDATE([Beginning of Month], -3)",
    "VAR Upstream_Out = ",
    "    CALCULATE(",
    "        [Upstream Actual Production Footage],",
    "        ALL( 'Calendar' ),",
    "        FILTER(",
    "            ALL( 'Upstream Log Simplified'[Start Time] ),",
    "            'Upstream Log Simplified'[Start Time] >= BegDate",
    "                && 'Upstream Log Simplified'[Start Time] < [Beginning of Month]",
    "        )",
    "    )",
    "",
    "VAR Conv_Out = ",
    "    CALCULATE(",
    "        [CONV Linear Footage],",
    "        ALL( 'Calendar' ),",
    "        FILTER(",
    "            ALL( 'Goods Movement'[Posting Date] ),",
    "            'Goods Movement'[Posting Date] >= BegDate",
    "                && 'Goods Movement'[Posting Date] < [Beginning of Month]",
    "        )",
    "    )",
    "",
    "VAR Other_Out = ",
    "    CALCULATE(",
    "        SUM('FACT_ProcessOrder'[DeliveredQuantity] ),",
    "        ALL( 'Calendar' ),",
    "        FILTER(",
    "            ALL( 'FACT_ProcessOrder'[EndDateKey] ),",
    "            'FACT_ProcessOrder'[EndDateKey] >= BegDate",
    "                && 'FACT_ProcessOrder'[EndDateKey] < [Beginning of Month]",
    "        ),",
    "        KEEPFILTERS( 'Process Order'[Close Flag] = \"Yes\" )",
    "    )",
    "",
    "RETURN",
    "DIVIDE(",
    "    CALCULATE(",
    "        [Absorption],",
    "        FILTER(",
    "            ALL( 'Calendar'[Date] ),",
    "            'Calendar'[Date] >= BegDate",
    "                && 'Calendar'[Date] < [Beginning of Month]",
    "        )",
    "    ),",
    "    SWITCH(",
    "        SELECTEDVALUE( 'Department'[Department] ),",
    "        \"CONV\", Conv_Out,",
    "        \"CAST\", Upstream_Out,",
    "        \"COAT\", Upstream_Out,",
    "        Other_Out",
    "    )",
    ")"
  ],
  "formatString": "#,0.00",
  "displayFolder": "Absorption\\_Projection",
  "annotations": [
    {
      "name": "TabularEditor_InPerspective",
      "value": "[\"Operations\",\"Planning\"]"
    }
  ]
}
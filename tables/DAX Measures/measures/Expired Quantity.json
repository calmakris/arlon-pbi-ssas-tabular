{
  "name": "Expired Quantity",
  "description": [
    "Total quantity of batch managed inventory with expiration/SLED date on or before yesterday.",
    "",
    "A material is batch managed if it is indicated so in the material master in SAP."
  ],
  "expression": [
    "",
    "VAR Qty = ",
    "    CALCULATE(",
    "        SUM( 'Inventory'[Quantity] ),",
    "        KEEPFILTERS( 'Inventory'[BatchManagedFlag] = \"Yes\" ),",
    "        FILTER(",
    "            ALL( 'Inventory'[Expiration Date] ),",
    "            'Inventory'[Expiration Date] <= [Report Date]",
    "        )",
    "    )",
    "",
    "VAR Amt =",
    "    CALCULATE(",
    "        SUM( 'Inventory'[AmountUSD] ),",
    "        KEEPFILTERS( 'Inventory'[BatchManagedFlag] = \"Yes\" ),",
    "        FILTER(",
    "            ALL( 'Inventory'[Expiration Date] ),",
    "            'Inventory'[Expiration Date] <= [Report Date]",
    "        )",
    "    )",
    "",
    "RETURN",
    "    IF(",
    "        HASONEVALUE( '_Value to Use'[Value] ),",
    "        SWITCH(",
    "            VALUES( '_Value to Use'[Value] ),",
    "            \"Quantity\", Qty,",
    "            \"Amount\", Amt,",
    "            Qty",
    "        ),",
    "        Qty",
    "    )",
    ""
  ],
  "formatString": "#,0.00",
  "displayFolder": "Inventory\\_Blocked\\_Expired",
  "annotations": [
    {
      "name": "TabularEditor_InPerspective",
      "value": "[\"Inventory\",\"Planning\",\"Product Management\",\"QA Dashboard\"]"
    }
  ]
}
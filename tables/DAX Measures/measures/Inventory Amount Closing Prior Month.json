{
  "name": "Inventory Amount Closing Prior Month",
  "description": "Total value of the inventory at the conclusion of the previous month.",
  "expression": [
    "",
    "-- Get last date with snapshot",
    "VAR _LastDateWithData =",
    "    CALCULATE(",
    "        MAX('Inventory Snapshots'[Snapshot Date]),",
    "        FILTER(",
    "            'Inventory Snapshots',",
    "            'Inventory Snapshots'[Snapshot Date] <= [Report Date]",
    "        )",
    "    )",
    "",
    "-- Get last date with snapshot last month",
    "VAR _DateRef = ",
    "    CALCULATE(",
    "        MAX('Inventory Snapshots'[Snapshot Date]),",
    "        FILTER(",
    "            ALL( 'Inventory Snapshots' ),",
    "            'Inventory Snapshots'[Snapshot Date] <= EOMONTH(_LastDateWithData, -1)",
    "                && 'Inventory Snapshots'[Snapshot Date] > EOMONTH(_LastDateWithData, -2)",
    "        )",
    "    )",
    "",
    "RETURN",
    "CALCULATE(",
    "    [Inventory Snapshot Amount],",
    "    FILTER(",
    "        ALL( 'Calendar' ),",
    "        'Calendar'[Date] = _DateRef",
    "    )",
    ")"
  ],
  "formatString": "#,0",
  "displayFolder": "Inventory\\_Time-Based",
  "annotations": [
    {
      "name": "TabularEditor_InPerspective",
      "value": "[\"Inventory\",\"Planning\"]"
    }
  ]
}
{
  "name": "Inventory Amount Opening Prior Week",
  "description": "Inventory snapshot amount on the Sunday of last week",
  "expression": [
    "",
    "-- Get last date of prev week",
    "VAR _LastDate =",
    "    CALCULATE(",
    "        MAX( 'Calendar'[Date] ),",
    "        FILTER(",
    "            'Calendar',",
    "            'Calendar'[Date] <= [Report Date]",
    "        )",
    "    ) - 7",
    "",
    "-- Get week no of last week's last date",
    "VAR _Week =",
    "    CALCULATE(",
    "        MAX( 'Calendar'[Calendar Week Number] ),",
    "        FILTER(",
    "            ALL( 'Calendar' ),",
    "            'Calendar'[Date] = _LastDate",
    "        )",
    "    )",
    "    ",
    "VAR _Year = FORMAT(_LastDate, \"yyyy\")",
    "    ",
    "-- Get Sunday of the week before last week",
    "VAR _DateRef =",
    "    CALCULATE(",
    "        MIN( 'Calendar'[Date] ),",
    "        FILTER(",
    "            ALL( 'Calendar' ),",
    "            'Calendar'[Calendar Week Number] = _Week",
    "                && 'Calendar'[Calendar Year] = _Year",
    "                && 'Calendar'[Weekday] = \"Sun\"",
    "        )",
    "    )",
    "",
    "RETURN",
    "CALCULATE(",
    "    [Inventory Snapshot Amount],",
    "    FILTER(",
    "        ALL( 'Calendar' ),",
    "        'Calendar'[Date] = _DateRef",
    "    )",
    ")"
  ],
  "formatString": "#,0",
  "displayFolder": "Inventory\\_Time-Based",
  "annotations": [
    {
      "name": "TabularEditor_InPerspective",
      "value": "[\"Inventory\",\"Planning\"]"
    }
  ]
}
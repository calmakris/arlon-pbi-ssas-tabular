{
  "name": "Inventory Annual Turns Last 12 Months",
  "description": [
    "This measure calculates the Annual Inventory Turnover rate for a rolling 12-month period where it calculates the total inventory consumption and average inventory for that period.",
    "",
    "If there's no consumption for the current month, it uses the turnover rate of the previous month. Otherwise, it calculates the turnover rate as the total consumption divided by the average inventory for the last year, then annualizes the result."
  ],
  "expression": [
    "",
    "VAR _LastDate =",
    "    CALCULATE(",
    "        MAX( 'Calendar'[Date] ),",
    "        FILTER(",
    "            'Calendar',",
    "            'Calendar'[Date] <= [Report Date]",
    "        )",
    "    )",
    "",
    "VAR _12MoAgo = EOMONTH(_LastDate, -13) + 1",
    "",
    "VAR _Consumption =",
    "    SUMX(",
    "        SUMMARIZE(",
    "            FILTER(",
    "                ALL( 'Calendar' ),",
    "                'Calendar'[Date] >= _12MoAgo",
    "                    && 'Calendar'[Date] <= _LastDate",
    "            ),",
    "            'Calendar'[Year_Month_Sort_Key],",
    "            \"Consume\", [Inventory Consumption Amount]",
    "        ),",
    "        [Consume]",
    "    )",
    "",
    "VAR _AvgStock =",
    "    SUMX(",
    "        SUMMARIZE(",
    "            FILTER(",
    "                ALL( 'Calendar' ),",
    "                'Calendar'[Date] >= _12MoAgo",
    "                    && 'Calendar'[Date] <= _LastDate",
    "            ),",
    "            'Calendar'[Year_Month_Sort_Key],",
    "            \"AvgStock\", [Inventory Amount Closing Last 2 Month Avg]",
    "        ),",
    "        [AvgStock]",
    "    )",
    "",
    "VAR _PrevMoTurns =",
    "    CALCULATE(",
    "        [Inventory Annual Turns],",
    "        FILTER(",
    "            ALL( 'Calendar' ),",
    "            'Calendar'[Date] <= EOMONTH( _LastDate, -1 )",
    "        )",
    "    )",
    "",
    "RETURN",
    "IF(",
    "    [Inventory Consumption Amount MTD] = 0",
    "        || ISBLANK( [Inventory Consumption Amount MTD] ),",
    "    _PrevMoTurns,",
    "    DIVIDE(",
    "        _Consumption,",
    "        _AvgStock",
    "    ) * 12",
    ")"
  ],
  "formatString": "#,0.00",
  "displayFolder": "Inventory\\_Time-Based",
  "annotations": [
    {
      "name": "TabularEditor_InPerspective",
      "value": "[\"Finance\",\"Inventory\",\"Operations\",\"Planning\"]"
    }
  ]
}
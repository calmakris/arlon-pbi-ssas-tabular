{
  "name": "Inventory Demand Quantity",
  "description": "This measure behaves differently based on the material type. For materials labeled as 'ROH' or 'HALB,' it calculates the cumulative sum of the process order reservations. If the material type is 'FERT' or 'HAWA,' the measure calculates the open quantities in sales orders considering allocations. For all other material types, the value of the measure is blank.",
  "expression": [
    "-- Finished goods and buyout demand is based on sales orders",
    "Var FERT_HAWA =",
    "    IF(",
    "        HASONEVALUE( 'Material Master'[Material Type] ),",
    "        SWITCH(",
    "            TRUE(),",
    "            { \"FERT\" } IN ALLSELECTED( 'Material Master'[Material Type] ), [Sales Order Open Internal Quantity],",
    "            { \"HAWA\" } IN ALLSELECTED( 'Material Master'[Material Type] ), [Sales Order Open Internal Quantity],",
    "            BLANK()",
    "        )",
    "    )",
    "",
    "-- Raw material and WIP demand is based on past open process order reservations",
    "Var ROH_HALB =",
    "    IF(",
    "        HASONEVALUE('Material Master'[Material Type]),",
    "        SWITCH(",
    "            TRUE(),",
    "            {\"ROH\"} IN ALLSELECTED('Material Master'[Material Type]),",
    "                CALCULATE(",
    "                    ABS(SUM('Process Order Reservation'[Requirement Quantity])),",
    "                    FILTER(",
    "                        ALL( 'Process Order Reservation'[Requirement Date] ),",
    "                        'Process Order Reservation'[Requirement Date] <= [Report Date]",
    "                    )",
    "                ),",
    "            {\"HALB\"} IN ALLSELECTED('Material Master'[Material Type]),",
    "                CALCULATE(",
    "                    ABS(SUM('Process Order Reservation'[Requirement Quantity])),",
    "                    FILTER(",
    "                        ALL( 'Process Order Reservation'[Requirement Date] ),",
    "                        'Process Order Reservation'[Requirement Date] <= [Report Date]",
    "                    )",
    "                ),",
    "            BLANK()",
    "        )",
    "    )",
    "",
    "Return FERT_HAWA + ROH_HALB",
    ""
  ],
  "formatString": "#,##0.00",
  "displayFolder": "Inventory",
  "annotations": [
    {
      "name": "TabularEditor_InPerspective",
      "value": "[\"Inventory\"]"
    }
  ]
}
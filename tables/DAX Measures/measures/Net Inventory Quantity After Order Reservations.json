{
  "name": "Net Inventory Quantity After Order Reservations",
  "description": "Difference between unrestricted stock quantity and cumulative total of open order reservations. Requirement date of the order reservation is the date to determine when the reservation consumes the quantity.",
  "expression": [
    "",
    "VAR _Today = [Report Date] + 1",
    "",
    "VAR _MinVisibleDate = MIN( 'Calendar'[Date] )",
    "",
    "VAR _Inventory =",
    "    IF(",
    "        [Unrestricted Stock Quantity] = 0,",
    "        BLANK(),",
    "        [Unrestricted Stock Quantity]",
    "    )",
    "",
    "VAR _MaxReqDateWithData = ",
    "    CALCULATE(",
    "        MAX( 'Process Order Reservation'[Requirement Date] ),",
    "        ALL( 'Calendar' )",
    "    )",
    "",
    "VAR _AllRequirement = ",
    "    CALCULATE( ",
    "        SUM( 'Process Order Reservation'[Requirement Quantity] ), ",
    "        ALL( 'Calendar' ) ",
    "    )",
    "",
    "VAR _HasRequirement =",
    "    _AllRequirement <> BLANK() && _AllRequirement <> 0",
    "    ",
    "VAR _CumulativeTotal =",
    "    CALCULATE(",
    "        SUM( 'Process Order Reservation'[Requirement Quantity] ),",
    "        FILTER(",
    "            ALL( 'Calendar'[Date] ),",
    "            'Calendar'[Date] <= MAX( 'Calendar'[Date] )",
    "        )",
    "    )",
    "",
    "RETURN",
    "IF(",
    "    _MinVisibleDate >= _Today,",
    "    _Inventory + _CumulativeTotal + IF( _HasRequirement, 0 )",
    ")"
  ],
  "formatString": "#,0.00",
  "displayFolder": "MRP",
  "annotations": [
    {
      "name": "TabularEditor_InPerspective",
      "value": "[\"Inventory\",\"Planning\"]"
    }
  ]
}
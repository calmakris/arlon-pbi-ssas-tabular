{
  "name": "Sales Order Amount Regional Budget Adjusted",
  "description": "Adjusted budget to meet the fiscal year-end goal if the previous months of the year didn't meet the goal",
  "expression": [
    " ",
    "VAR _MinVisibleDate = MIN( 'Calendar'[Date] )",
    "",
    "VAR _sales =",
    "    CALCULATE(",
    "        [Gross Sales],",
    "        FILTER(",
    "            ALL( 'Calendar' ),",
    "            'Calendar'[Date] >= [Beginning of Fiscal Year]",
    "                && 'Calendar'[Date] <= [End of Prior Month]",
    "        )",
    "    )",
    "",
    "VAR _goal =",
    "    CALCULATE(",
    "        [Sales Order Amount Regional Budget],",
    "        FILTER(",
    "            ALL( 'Calendar' ),",
    "            'Calendar'[Date] >= [Beginning of Fiscal Year]",
    "                && 'Calendar'[Date] <= [End of Month]",
    "        )",
    "    )",
    "",
    "VAR _currentMonthProj = [Sales Order Amount Projected Current Month End]",
    "",
    "VAR _currentPeriod = MONTH( [Report Date] ) - IF( MONTH( [Report Date] ) >= 10, 9, -3 )",
    "",
    "VAR _remainMonthsInFY =",
    "--- Remaining months of FY excluding next month",
    "--- Per LBABILO, some orders taken this month gets shipped next month",
    "    IF(",
    "        _currentPeriod >= 8,",
    "        0,",
    "        12 - _currentPeriod + 1",
    "    )",
    "",
    "VAR _extraNeeded = DIVIDE( ( _goal - _sales - _currentMonthProj ), _remainMonthsInFY )",
    "",
    "RETURN",
    "IF(",
    "    _MinVisibleDate > [End of Month],",
    "    [Sales Order Amount Regional Budget] + _extraNeeded",
    ")"
  ],
  "formatString": "#,0",
  "displayFolder": "Sales Order\\_Order Entry Analysis",
  "annotations": [
    {
      "name": "TabularEditor_InPerspective",
      "value": "[\"Finance\",\"Sales Orders\"]"
    }
  ]
}
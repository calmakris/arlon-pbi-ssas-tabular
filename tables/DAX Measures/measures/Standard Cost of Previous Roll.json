{
  "name": "Standard Cost of Previous Roll",
  "description": "Standard cost of the material based on the previous cost roll. It is also the sum of material, labor, overhead, setup, and additive costs. This measure is best used if analyzed by 'Material Master' and/or 'Plant'. Also If this is analyzed by 'Calendar', this measure shows the last cost within a date range.",
  "expression": [
    "VAR _isMaterialFiltered = HASONEFILTER( 'Material Costing History'[Material Number] ) || ISFILTERED( 'Material Master' )",
    "VAR _isPlantFiltered = HASONEFILTER( 'Material Costing History'[Plant] ) || ISFILTERED( 'Plant' )",
    "VAR _maxVisibleDate = ",
    "    CALCULATE(",
    "        MAX( 'Calendar'[Date] ),",
    "        FILTER(",
    "            'Calendar',",
    "            'Calendar'[Date] <= [Report Date]",
    "        )",
    "    )",
    "",
    "VAR _latestRank =",
    "    CALCULATE(",
    "        IF(",
    "            _isMaterialFiltered && _isPlantFiltered,",
    "            MIN( 'Material Costing History'[LatestRank] ),",
    "            IF(",
    "                _isMaterialFiltered,",
    "                CALCULATE(",
    "                    MIN( 'Material Costing History'[LatestRank] ),",
    "                    KEEPFILTERS( 'Plant'[Plant] = \"1001\" )",
    "                ),",
    "                BLANK()",
    "            )",
    "        ),",
    "        FILTER(",
    "            'Material Costing History',",
    "            'Material Costing History'[Costing Start Date] <= _maxVisibleDate",
    "        )",
    "    )",
    "",
    "RETURN",
    "    IF(",
    "        ISBLANK(_latestRank),",
    "        BLANK(),",
    "        SWITCH(",
    "            TRUE(),",
    "            HASONEVALUE( Plant[Plant] ),",
    "                CALCULATE(",
    "                    AVERAGE( 'Material Costing History'[Standard Cost] ),",
    "                    KEEPFILTERS( 'Material Costing History'[LatestRank] = _latestRank + 1 )",
    "                ),",
    "            CALCULATE(",
    "                AVERAGE( 'Material Costing History'[Standard Cost] ),",
    "                KEEPFILTERS( 'Material Costing History'[LatestRank] = _latestRank + 1 ),",
    "                KEEPFILTERS( Plant[Plant] = \"1001\" )",
    "            )",
    "        )",
    "    )"
  ],
  "formatString": "#,0.00",
  "displayFolder": "Material Cost and Price",
  "annotations": [
    {
      "name": "TabularEditor_InPerspective",
      "value": "[\"Product Management\"]"
    }
  ]
}